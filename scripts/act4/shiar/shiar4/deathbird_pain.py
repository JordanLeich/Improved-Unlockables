# Generated by BehavEd
# ( "Deathbird's pain script" )
# ( "calculate health percentage" )
stage = getZoneVar("stage" )
stage = iadd(stage, 1 )
health = getHealth("_OWNER_" )
healthmax = getHealthMax("_OWNER_" )
hamt = fdiv(health, healthmax )
# ( "figure out what the theshold for the next stage should be" )
thresh = fmul(stage, 0.500 )
hthresh = fsub(1.000000, thresh )
if hamt < hthresh
     setZoneVar("stage", stage )
     newhealth = fmul(hthresh, healthmax )
     setHealth("_OWNER_", newhealth )
     # ( "-- do the stuff --" )
     startCutScene("FALSE", "FALSE" )
     cameraMove(" 1486.980 1547.510 233.250 ", 0.500 )
     cameraPan(" 0.000 26.000 221.800 ", 0.500, "FALSE" )
     # ( "bring in the crystal" )
     setInvisible("tube", "FALSE" )
     act("tube", "tube" )
     waittimed ( 1.000 )
     act("teleporter_loop", "teleporter_loop" )
     waittimed ( 2.000 )
     act("teleport_flash", "teleport_flash" )
     remove ( "throne", "throne" )
     waittimed ( 1.000 )
     act("teleport_flash", "teleport_flash" )
     copyOriginAndAngles("crystal", "teleporter_loop" )
     waittimed ( 1.000 )
     act("teleporter_loop", "teleporter_loop" )
     act("tube", "tube" )
     waittimed ( 1.000 )
     # ( "crystal powers up deathbird" )
     setEnable("db_beam", "TRUE" )
     setEnable("crystal", "TRUE" )
     setInvulnerable("deathbird", "TRUE" )
     waittimed ( 1.000 )
     overrideFocusToEntity("deathbird", 2.000 )
     waittimed ( 1.000 )
     playCombatNodeTrigger("deathbird", "deathbird", "powerup_invul", 71 )
     waittimed ( 1.000 )
     setInvisible("tube", "TRUE" )
     endCutScene("FALSE", "TRUE" )
     cameraResetOldSchool( )
endif
if health <= 1
     dead = getGameFlag("bosses", 27 )
     if dead  == 0
          # ( "prepare cut scene, move camera to show throne" )
          setGameFlag("bosses", 27, 1 )
          startCutScene("TRUE", "TRUE" )
          setteam (  "BEHAVED_TEAM_NONE", "deathbird" )
          setNoTarget("deathbird", "TRUE" )
          heroNoTarget("TRUE" )
          cameraMove(" 1549.330 1379.430 87.520 ", 0.000 )
          cameraPan(" 0.000 29.100 193.500 ", 0.000, "FALSE" )
          # ( "move heroes to off-camera" )
          moveHeroesToEnt("playerspot" )
          copyOriginAndAngles("deathbird", "db_spot" )
          setEnable("db_beam", "FALSE" )
          setInvisible("tube", "FALSE" )
          remove ( "db_beam", "db_beam" )
          act("tube", "tube" )
          # ( "fade in" )
          cameraFade(0.000, 0.500 )
          waittimed ( 1.000 )
          act("teleporter_loop", "teleporter_loop" )
          setEnable("link_shiar5", "TRUE" )
          # ( "enable zone_link to shair5 so the heroes can follow Deathbird" )
          sound (  "PLAY_SOUND", "common/game/achievement", "", "" )
          createPopupDialogXml("dialogs/special/deathbird_achievement" )
          waittimed ( 0.100 )
          unlockCharacter("dbird", "" )
          waittimed ( 0.100 )
          unlockCharacter("Blastaar", "" )
          waittimed ( 0.100 )
          unlockCharacter("blindfold", "" )
          waittimed ( 0.100 )
          unlockCharacter("Wraith", "" )
          waittimed ( 0.100 )
          unlockCharacter("blaze", "" )
          waittimed ( 0.100 )
          unlockCharacter("LivMon", "" )
          waittimed ( 0.100 )
          unlockCharacter("Lizard_Hero", "" )
          waittimed ( 0.100 )
          unlockCharacter("Leader", "" )
          waittimed ( 0.100 )
          unlockCharacter("blackboltdlc", "")
          waittimed ( 0.100 )
          startCharConversation("act4/shiar/shiar4/4_shiar4_030", "IRONMAN", "act4/shiar/shiar4/4_shiar4_032" )
     endif
endif

