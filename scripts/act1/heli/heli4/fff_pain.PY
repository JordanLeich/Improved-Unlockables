# Generated by BehavEd
# ( "fff's pain" )
ondeck = getZoneVar("ondeck" )
if ondeck == 0
     # ( "fff is flying" )
     weap = getHeldWeapon("_ACTIVATOR_" )
     # ( "only allow heroes in the gun to shoot him down" )
     if weap == "the_gun"
          # ( "spawn some more minions" )
          var = getZoneVar("minions" )
          # ( "less than 4 minions?" )
          if var < 4
               # ( "increment minion count" )
               var = iadd(var, 1 )
               setZoneVar("minions", var )
               spawner = strcatint("fff_minion0", var )
               act(spawner, spawner )
          endif
          var = getZoneVar("shootable" )
          # ( "is he shootable?" )
          if var == 1
               setZoneVar("shootable", 0 )
               overrideFocusToEntity("finfangfoom", 1.500 )
               # ( "fff is upclose.. make him wipe out." )
               var = getZoneVar("divebomb" )
               if var == 1
                    ypos = getPosY("finfangfoom" )
                    if ypos > 8880
                         # ( "ensure FFF doesn't fall through deck" )
                         setCombatNode("finfangfoom", "pain" )
                    endif
               else
                    setCombatNode("finfangfoom", "pain_low" )
               endif
          endif
          # ( "now make him land on the deck when he gets a chance" )
          setPatternSequence("finfangfoom", "fff_ondeck" )
          fffhits = getZoneVar("fffhits" )
          painthresh = fmul(0.310, fffhits )
          painthresh = fsub(1.000, painthresh )
          painthresh = fmul(painthresh, 100.000 )
          setZoneVar("painthresh", painthresh )
     endif
else
     # ( "fff is on the deck" )
     ipt = getZoneVar("painthresh" )
     pt = fdiv(ipt, 100.000 )
     h = getHealth("finfangfoom" )
     hm = getHealthMax("finfangfoom" )
     hp = fdiv(h, hm )
     if hp <= pt
          if pt < 0.100000
               # ( "he's dead" )
               setHealth("finfangfoom", 1 )
               setCombatNode("finfangfoom", "deathgen" )
               setZoneVar("ondeck", 0 )
               setDefaultTarget("" )
               waittimed ( 4.000 )
               remove ( "finfangfoom", "finfangfoom" )
               setGameFlag("bosses", 2, 1 )
               objective ( "heli_obj40",  "EOBJCMD_COMPLETE" )
               awardAchievement("", "defeated_fingfangfoom" )
               sound (  "PLAY_SOUND", "common/game/achievement", "", "" )
               createPopupDialogXml("dialogs/special/fingfangfoom_achievement" )
               waittimed ( 0.100 )
               
               nickfury = isActorOnTeam("Nickfury" )
               if nickfury == 0
                   awardAchievement("", "unlocked_nickfury" )
                   waittimed ( 0.100 )
                   unlockCharacter("nickfury", "" )
                   waittimed ( 0.100 )
                   sound (  "PLAY_SOUND", "common/game/achievement", "", "" )
                   createPopupDialogXml("dialogs/special/nickfury_achievement" )
                   waittimed ( 0.100 )
               endif
                   
               unlockCharacter("Taskmaster", "" )
               waittimed ( 0.100 )
               unlockCharacter("storm", "" )
               waittimed ( 0.100 )
               unlockCharacter("Warmachine", "" )
               waittimed ( 0.100 )
               unlockCharacter("sable", "" )
               waittimed ( 0.100 )
               unlockCharacter("ted", "" )
               waittimed ( 0.100 )
               unlockCharacter("devilhulk", "" )
               waittimed ( 0.100 )
               unlockCharacter("greenscar", "" )
               waittimed ( 0.100 )
               unlockCharacter("banner", "" )
               waittimed ( 0.100 )
               unlockCharacter("ferhul", "" )
               waittimed ( 0.100 )
               unlockCharacter("mergedhulk", "" )
               waittimed ( 0.100 )
               unlockCharacter("ted", "" )
               waittimed ( 0.100 )
               unlockCharacter("hellion", "" )
               waittimed ( 0.100 )
               unlockCharacter("visiondlc", "" )
               waittimed ( 0.100 )
               unlockCharacter("ironman", "" )
               waittimed ( 0.100 )
               unlockCharacter("ironheart", "" )
               waittimed ( 0.100 )
               unlockCharacter("yelena", "" )
               waittimed ( 0.100 )
               unlockCharacter("blackwidowv", "" )
               waittimed ( 0.100 )
               unlockCharacter("Kate", "" )
               waittimed ( 0.100 )
               unlockCharacter("HumanTorch", "" )
               waittimed ( 0.100 )
               unlockCharacter("MrFantastic", "" )
               waittimed ( 0.100 )
               unlockCharacter("Hawkeye", "" )
               waittimed ( 0.100 )
               awardReputation("", 50 )
               spawn("fff_treasure_spot", "FinFangFoom_treasure", "treasure", " 0.000 0.000 0.000 ", " 0.000 0.000 0.000 " )
               waittimed ( 3.000 )
               setMusicOverride("", 1.000 )
               startConversation("act1/heli/heli4/1_HELI4_030" )
               setEnable("into_leftside", "TRUE" )
               remove ( "fff_minion01", "fff_minion01" )
               remove ( "fff_minion02", "fff_minion02" )
               remove ( "fff_minion03", "fff_minion03" )
               remove ( "fff_minion04", "fff_minion04" )
          else
               # ( "enough damage - fly away" )
               nh = fmul(hm, pt )
               setHealth("finfangfoom", nh )
               setPatternSequence("finfangfoom", "fff_offdeck" )
          endif
     endif
endif

